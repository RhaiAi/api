openapi: 3.0.3
info:
  title: RHAI API
  description: >
    Cat√°logo oficial de endpoints da plataforma RHAI.  
    Apenas **Edge Functions** ficam expostas no Swagger.  
    RPCs e tabelas internas n√£o aparecem.  
  version: 1.0.0
  contact:
    name: Time RHAI
    email: suporte@rhai.com

servers:
  - url: https://gmtexatrdgqaymnknopd.supabase.co/functions/v1
    description: Supabase RHAI (produ√ß√£o)
  - url: http://localhost:54321/functions/v1
    description: Supabase RHAI (local dev)

tags:
  - name: Busca Ocupacional
    description: Endpoints relacionados √† super busca e autocomplete de ocupa√ß√µes.
  - name: Cursos
    description: Endpoints para CRUD de cursos.
  - name: Ocupa√ß√£o ‚Üî Cursos
    description: Endpoints para vincular cursos √†s ocupa√ß√µes.

paths:
  # ============================================================
  # üîπ BLOCO: BUSCA OCUPACIONAL
  # ============================================================
  /search-occupation:
    post:
      tags: [Busca Ocupacional]
      summary: Super Busca Ocupacional (RHAI)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [search_term]
              properties:
                search_term:
                  type: string
                  example: "engenheiro de prompt"
      responses:
        '200':
          description: Resposta padronizada
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno do servidor

  /rhai_edge_search_occupation_list:
    get:
      tags: [Busca Ocupacional]
      summary: Autocomplete de ocupa√ß√µes
      description: >
        Retorna lista de ocupa√ß√µes **ativas** com busca parcial (ILIKE)  
        em `occupations.name` e `occupation_similar_names_new.normalized_name`.  
        Usado em dropdowns/autocomplete no Lovable.
      parameters:
        - name: query
          in: query
          description: Texto de busca parcial
          schema: { type: string }
          example: "diretor de criacao"
        - name: limit
          in: query
          schema: { type: integer, default: 50, minimum: 1, maximum: 200 }
        - name: offset
          in: query
          schema: { type: integer, default: 0, minimum: 0 }
      responses:
        '200':
          description: Lista de ocupa√ß√µes encontradas
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:   { type: integer, example: 750 }
                        name: { type: string,  example: "Diretor de cria√ß√£o" }
                        register_code: { type: string, example: "2531-30" }
        '500':
          description: Erro interno

  # ============================================================
  # üîπ BLOCO: CURSOS
  # ============================================================
  /rhai_edge_courses_new/list:
    get:
      tags: [Cursos]
      summary: Listar cursos
      parameters:
        - name: p_query
          in: query
          schema: { type: string }
        - name: p_limit
          in: query
          schema: { type: integer, default: 50 }
        - name: p_offset
          in: query
          schema: { type: integer, default: 0 }
      responses:
        '200':
          description: Lista de cursos

  /rhai_edge_courses_new/insert:
    post:
      tags: [Cursos]
      summary: Inserir curso
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                p_name: { type: string }
                p_qualification_type_id: { type: integer }
                p_country_id: { type: integer }
      responses:
        '200':
          description: Curso inserido
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno

  /rhai_edge_courses_new/update:
    put:
      tags: [Cursos]
      summary: Atualizar curso
      responses:
        '200':
          description: Curso atualizado
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno

  /rhai_edge_courses_new/delete/{id}:
    delete:
      tags: [Cursos]
      summary: Remover curso
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Curso removido
        '404':
          description: Curso n√£o encontrado

  /rhai_edge_search_courses_autocomplete:
    get:
      tags: [Cursos]
      summary: Autocomplete de cursos
      description: >
        Retorna cursos ativos para autocomplete.  
        Usa busca `ILIKE` em `name` e `name_normalized`.  
        Paginado por `limit` e `offset`.
      parameters:
        - name: query
          in: query
          schema: { type: string }
          example: "administra√ß√£o"
        - name: limit
          in: query
          schema: { type: integer, default: 20 }
        - name: offset
          in: query
          schema: { type: integer, default: 0 }
      responses:
        '200':
          description: Lista de cursos encontrados
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:   { type: integer, example: 1 }
                        name: { type: string, example: "Administra√ß√£o" }
                        qualification_type: { type: string, example: "Bacharelado" }
                        country_name: { type: string, example: "Brasil" }
        '500':
          description: Erro interno

  # ============================================================
  # üîπ BLOCO: OCUPA√á√ÉO ‚Üî CURSOS
  # ============================================================
  /rhai_edge_occ_edu/list:
    get:
      tags: [Ocupa√ß√£o ‚Üî Cursos]
      summary: Listar v√≠nculos Ocupa√ß√£o ‚Üî Curso
      parameters:
        - name: p_occupation_ids
          in: query
          schema: { type: array, items: { type: integer } }
        - name: p_course_ids
          in: query
          schema: { type: array, items: { type: integer } }
      responses:
        '200':
          description: Lista de v√≠nculos

  /rhai_edge_occ_edu/insert:
    post:
      tags: [Ocupa√ß√£o ‚Üî Cursos]
      summary: Criar v√≠nculo
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                p_occupation_id: { type: integer }
                p_course_id: { type: integer }
                p_mandatory: { type: boolean }
                p_relevance: { type: string, enum: [AR,MR,BR] }
                p_notes: { type: string }
      responses:
        '200':
          description: V√≠nculo criado
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno

  /rhai_edge_occ_edu/update:
    put:
      tags: [Ocupa√ß√£o ‚Üî Cursos]
      summary: Atualizar v√≠nculo
      responses:
        '200':
          description: V√≠nculo atualizado
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno

  /rhai_edge_occ_edu/delete/{id}:
    delete:
      tags: [Ocupa√ß√£o ‚Üî Cursos]
      summary: Remover v√≠nculo (soft delete)
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: V√≠nculo removido
        '404':
          description: V√≠nculo n√£o encontrado

   # ============================================================
  # üîπ BLOCO: HARD SKILLS
  # ============================================================
  /rhai_edge_hard_skills_crud/list:
    get:
      tags: [Hard Skills]
      summary: Listar Hard Skills
      description: >
        Retorna a lista de Hard Skills da biblioteca, com filtros opcionais
        de busca, ativos e validados.
      parameters:
        - name: q
          in: query
          description: Texto parcial para busca
          schema: { type: string }
          example: "excel"
        - name: only_active
          in: query
          schema: { type: boolean, default: true }
          description: Se `false`, retorna inclusive desativadas
        - name: only_validated
          in: query
          schema: { type: boolean, default: false }
          description: Se `true`, retorna apenas skills validadas
      responses:
        '200':
          description: Lista de hard skills encontradas
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id: { type: integer, example: 2 }
                        skill_name: { type: string, example: "Excel" }
                        normalized_name: { type: string, example: "excel" }
                        area: { type: string, example: "Administra√ß√£o" }
                        validated: { type: boolean, example: false }
                        is_active: { type: boolean, example: true }

  /rhai_edge_hard_skills_crud/insert:
    post:
      tags: [Hard Skills]
      summary: Criar Hard Skill
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_skill_name]
              properties:
                p_skill_name:
                  type: string
                  example: "Excel"
                p_area:
                  type: string
                  example: "Administra√ß√£o"
      responses:
        '200':
          description: Hard Skill criada
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno

  /rhai_edge_hard_skills_crud/update:
    put:
      tags: [Hard Skills]
      summary: Atualizar Hard Skill
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_id, p_skill_name]
              properties:
                p_id: { type: integer, example: 2 }
                p_skill_name: { type: string, example: "Excel Avan√ßado" }
                p_area: { type: string, example: "TI" }
      responses:
        '200':
          description: Hard Skill atualizada
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno

  /rhai_edge_hard_skills_crud/delete/{id}:
    delete:
      tags: [Hard Skills]
      summary: Deletar (soft delete) Hard Skill
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
          example: 2
      responses:
        '200':
          description: Hard Skill desativada
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno

  /rhai_edge_search_hard_skills:
    post:
      tags: [Hard Skills]
      summary: Autocomplete de Hard Skills
      description: >
        Retorna lista de Hard Skills **ativas** com busca parcial (ILIKE)  
        em `skill_name` e `normalized_name`.  
        Usado em dropdowns/autocomplete no Lovable.  
        Suporta GET (?q=texto) e POST ({ q: "texto" }).  
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                q:
                  type: string
                  example: "excel"
      responses:
        '200':
          description: Lista de hard skills encontradas
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean }
                  results:
                    type: array
                    items:
                      type: object
                      properties:
                        id:          { type: integer, example: 2 }
                        skill_name:  { type: string, example: "Excel" }
                        area:        { type: string, example: "Administra√ß√£o" }
        '500':
          description: Erro interno


  # ============================================================
  # üîπ BLOCO: SOFT SKILLS
  # ============================================================
  /rhai_edge_soft_skills_crud/list:
    get:
      tags: [Soft Skills]
      summary: Listar Soft Skills
      description: >
        Retorna a lista de Soft Skills da biblioteca, com filtros opcionais
        de busca, ativos e validados.
      parameters:
        - name: q
          in: query
          description: Texto parcial para busca
          schema: { type: string }
          example: "resiliencia"
        - name: only_active
          in: query
          schema: { type: boolean, default: true }
          description: Se `false`, retorna inclusive desativadas
        - name: only_validated
          in: query
          schema: { type: boolean, default: false }
          description: Se `true`, retorna apenas skills validadas
      responses:
        '200':
          description: Lista de soft skills encontradas
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id: { type: integer, example: 1 }
                        soft_skill_name: { type: string, example: "Resili√™ncia Emocional" }
                        normalized_name: { type: string, example: "resiliencia emocional" }
                        theme: { type: string, example: "Lideran√ßa" }
                        validated: { type: boolean, example: false }
                        is_active: { type: boolean, example: true }

  /rhai_edge_soft_skills_crud/insert:
    post:
      tags: [Soft Skills]
      summary: Criar Soft Skill
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_soft_skill_name]
              properties:
                p_soft_skill_name:
                  type: string
                  example: "Resili√™ncia"
                p_theme:
                  type: string
                  example: "Interpessoal"
      responses:
        '200':
          description: Soft Skill criada
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno

  /rhai_edge_soft_skills_crud/update:
    put:
      tags: [Soft Skills]
      summary: Atualizar Soft Skill
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_id, p_soft_skill_name]
              properties:
                p_id: { type: integer, example: 1 }
                p_soft_skill_name: { type: string, example: "Resili√™ncia Emocional" }
                p_theme: { type: string, example: "Lideran√ßa" }
      responses:
        '200':
          description: Soft Skill atualizada
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno

  /rhai_edge_soft_skills_crud/delete/{id}:
    delete:
      tags: [Soft Skills]
      summary: Deletar (soft delete) Soft Skill
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
          example: 1
      responses:
        '200':
          description: Soft Skill desativada
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno

  /rhai_edge_search_soft_skills:
    post:
      tags: [Soft Skills]
      summary: Autocomplete de Soft Skills
      description: >
        Retorna lista de Soft Skills **ativas** com busca parcial (ILIKE)  
        em `soft_skill_name` e `normalized_name`.  
        Usado em dropdowns/autocomplete no Lovable.  
        Suporta GET (?q=texto) e POST ({ q: "texto" }).  
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                q:
                  type: string
                  example: "resiliencia"
      responses:
        '200':
          description: Lista de soft skills encontradas
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean }
                  results:
                    type: array
                    items:
                      type: object
                      properties:
                        id:               { type: integer, example: 1 }
                        soft_skill_name:  { type: string, example: "Resili√™ncia Emocional" }
                        theme:            { type: string, example: "Lideran√ßa" }
        '500':
          description: Erro interno

  # ============================================================
  # üîπ BLOCO: OCUPA√á√ÉO ‚Üî HARD SKILLS
  # ============================================================
  /rhai_edge_occupation_hard_skills/list:
    get:
      tags: [Ocupa√ß√£o ‚Üî Hard Skills]
      summary: Listar Hard Skills vinculadas √† ocupa√ß√£o
      parameters:
        - name: occupation_id
          in: query
          required: true
          schema: { type: integer }
          example: 123
        - name: only_active
          in: query
          schema: { type: boolean, default: true }
          description: Se `false`, retorna inclusive v√≠nculos desativados
      responses:
        '200':
          description: Lista de v√≠nculos encontrados
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id: { type: integer, example: 10 }
                        occupation_id: { type: integer, example: 123 }
                        skill_id: { type: integer, example: 2 }
                        skill_name: { type: string, example: "Excel" }
                        mandatory: { type: boolean, example: true }
                        relevance: { type: string, example: "AR" }
                        validated: { type: boolean, example: false }
                        is_active: { type: boolean, example: true }

  /rhai_edge_occupation_hard_skills/insert:
    post:
      tags: [Ocupa√ß√£o ‚Üî Hard Skills]
      summary: Vincular Hard Skill √† ocupa√ß√£o
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_occupation_id, p_skill_id]
              properties:
                p_occupation_id: { type: integer, example: 123 }
                p_skill_id: { type: integer, example: 2 }
                p_mandatory: { type: boolean, example: true }
                p_relevance: { type: string, enum: [AR, MR, BR, NONE], example: "AR" }
      responses:
        '200':
          description: V√≠nculo criado
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno

  /rhai_edge_occupation_hard_skills/update:
    put:
      tags: [Ocupa√ß√£o ‚Üî Hard Skills]
      summary: Atualizar v√≠nculo de Hard Skill com ocupa√ß√£o
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_id]
              properties:
                p_id: { type: integer, example: 10 }
                p_mandatory: { type: boolean, example: false }
                p_relevance: { type: string, enum: [AR, MR, BR, NONE], example: "MR" }
                p_validated: { type: boolean, example: true }
                p_is_active: { type: boolean, example: true }
      responses:
        '200':
          description: V√≠nculo atualizado
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno

  /rhai_edge_occupation_hard_skills/delete/{id}:
    delete:
      tags: [Ocupa√ß√£o ‚Üî Hard Skills]
      summary: Deletar (soft delete) v√≠nculo Hard Skill ‚Üî ocupa√ß√£o
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
          example: 10
      responses:
        '200':
          description: V√≠nculo desativado
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno


  # ============================================================
  # üîπ BLOCO: OCUPA√á√ÉO ‚Üî SOFT SKILLS
  # ============================================================
  /rhai_edge_occupation_soft_skills/list:
    get:
      tags: [Ocupa√ß√£o ‚Üî Soft Skills]
      summary: Listar Soft Skills vinculadas √† ocupa√ß√£o
      parameters:
        - name: occupation_id
          in: query
          required: true
          schema: { type: integer }
          example: 123
        - name: only_active
          in: query
          schema: { type: boolean, default: true }
          description: Se `false`, retorna inclusive v√≠nculos desativados
      responses:
        '200':
          description: Lista de v√≠nculos encontrados
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id: { type: integer, example: 15 }
                        occupation_id: { type: integer, example: 123 }
                        soft_skill_id: { type: integer, example: 7 }
                        soft_skill_name: { type: string, example: "Resili√™ncia Emocional" }
                        target_level: { type: integer, example: 4 }
                        criticality: { type: boolean, example: true }
                        validated: { type: boolean, example: false }
                        is_active: { type: boolean, example: true }

  /rhai_edge_occupation_soft_skills/insert:
    post:
      tags: [Ocupa√ß√£o ‚Üî Soft Skills]
      summary: Vincular Soft Skill √† ocupa√ß√£o
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_occupation_id, p_soft_skill_id, p_target_level]
              properties:
                p_occupation_id: { type: integer, example: 123 }
                p_soft_skill_id: { type: integer, example: 7 }
                p_target_level: { type: integer, minimum: 1, maximum: 5, example: 4 }
                p_criticality: { type: boolean, example: true }
      responses:
        '200':
          description: V√≠nculo criado
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno

  /rhai_edge_occupation_soft_skills/update:
    put:
      tags: [Ocupa√ß√£o ‚Üî Soft Skills]
      summary: Atualizar v√≠nculo de Soft Skill com ocupa√ß√£o
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [p_id]
              properties:
                p_id: { type: integer, example: 15 }
                p_target_level: { type: integer, minimum: 1, maximum: 5, example: 5 }
                p_criticality: { type: boolean, example: false }
                p_validated: { type: boolean, example: true }
                p_is_active: { type: boolean, example: true }
      responses:
        '200':
          description: V√≠nculo atualizado
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno

  /rhai_edge_occupation_soft_skills/delete/{id}:
    delete:
      tags: [Ocupa√ß√£o ‚Üî Soft Skills]
      summary: Deletar (soft delete) v√≠nculo Soft Skill ‚Üî ocupa√ß√£o
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
          example: 15
      responses:
        '200':
          description: V√≠nculo desativado
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno
