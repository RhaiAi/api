openapi: 3.0.3
info:
  title: RHAI API
  description: >
    Cat√°logo oficial de endpoints da plataforma RHAI.  
    Apenas **Edge Functions** ficam expostas no Swagger.  
    RPCs e tabelas internas n√£o aparecem.  
  version: 1.0.0
  contact:
    name: Time RHAI
    email: suporte@rhai.com

servers:
  - url: https://gmtexatrdgqaymnknopd.supabase.co/functions/v1
    description: Supabase RHAI (produ√ß√£o)
  - url: http://localhost:54321/functions/v1
    description: Supabase RHAI (local dev)

tags:
  - name: Busca Ocupacional
    description: Endpoints relacionados √† super busca e autocomplete de ocupa√ß√µes.
  - name: Cursos
    description: Endpoints para CRUD de cursos.
  - name: Ocupa√ß√£o ‚Üî Cursos
    description: Endpoints para vincular cursos √†s ocupa√ß√µes.

paths:
  # ============================================================
  # üîπ BLOCO: BUSCA OCUPACIONAL
  # ============================================================
  /search-occupation:
    post:
      tags: [Busca Ocupacional]
      summary: Super Busca Ocupacional (RHAI)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [search_term]
              properties:
                search_term:
                  type: string
                  example: "engenheiro de prompt"
      responses:
        '200':
          description: Resposta padronizada
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno do servidor

  /rhai_edge_search_occupation_list:
    get:
      tags: [Busca Ocupacional]
      summary: Autocomplete de ocupa√ß√µes
      description: >
        Retorna lista de ocupa√ß√µes **ativas** com busca parcial (ILIKE)  
        em `occupations.name` e `occupation_similar_names_new.normalized_name`.  
        Usado em dropdowns/autocomplete no Lovable.
      parameters:
        - name: query
          in: query
          description: Texto de busca parcial
          schema: { type: string }
          example: "diretor de criacao"
        - name: limit
          in: query
          schema: { type: integer, default: 50, minimum: 1, maximum: 200 }
        - name: offset
          in: query
          schema: { type: integer, default: 0, minimum: 0 }
      responses:
        '200':
          description: Lista de ocupa√ß√µes encontradas
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:   { type: integer, example: 750 }
                        name: { type: string,  example: "Diretor de cria√ß√£o" }
                        register_code: { type: string, example: "2531-30" }
        '500':
          description: Erro interno

  # ============================================================
  # üîπ BLOCO: CURSOS
  # ============================================================
  /rhai_edge_courses_new/list:
    get:
      tags: [Cursos]
      summary: Listar cursos
      parameters:
        - name: p_query
          in: query
          schema: { type: string }
        - name: p_limit
          in: query
          schema: { type: integer, default: 50 }
        - name: p_offset
          in: query
          schema: { type: integer, default: 0 }
      responses:
        '200':
          description: Lista de cursos

  /rhai_edge_courses_new/insert:
    post:
      tags: [Cursos]
      summary: Inserir curso
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                p_name: { type: string }
                p_qualification_type_id: { type: integer }
                p_country_id: { type: integer }
      responses:
        '200':
          description: Curso inserido
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno

  /rhai_edge_courses_new/update:
    put:
      tags: [Cursos]
      summary: Atualizar curso
      responses:
        '200':
          description: Curso atualizado
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno

  /rhai_edge_courses_new/delete/{id}:
    delete:
      tags: [Cursos]
      summary: Remover curso
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Curso removido
        '404':
          description: Curso n√£o encontrado

  /rhai_edge_search_courses_autocomplete:
    get:
      tags: [Cursos]
      summary: Autocomplete de cursos
      description: >
        Retorna cursos ativos para autocomplete.  
        Usa busca `ILIKE` em `name` e `name_normalized`.  
        Paginado por `limit` e `offset`.
      parameters:
        - name: query
          in: query
          schema: { type: string }
          example: "administra√ß√£o"
        - name: limit
          in: query
          schema: { type: integer, default: 20 }
        - name: offset
          in: query
          schema: { type: integer, default: 0 }
      responses:
        '200':
          description: Lista de cursos encontrados
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:   { type: integer, example: 1 }
                        name: { type: string, example: "Administra√ß√£o" }
                        qualification_type: { type: string, example: "Bacharelado" }
                        country_name: { type: string, example: "Brasil" }
        '500':
          description: Erro interno

  # ============================================================
  # üîπ BLOCO: OCUPA√á√ÉO ‚Üî CURSOS
  # ============================================================
  /rhai_edge_occ_edu/list:
    get:
      tags: [Ocupa√ß√£o ‚Üî Cursos]
      summary: Listar v√≠nculos Ocupa√ß√£o ‚Üî Curso
      parameters:
        - name: p_occupation_ids
          in: query
          schema: { type: array, items: { type: integer } }
        - name: p_course_ids
          in: query
          schema: { type: array, items: { type: integer } }
      responses:
        '200':
          description: Lista de v√≠nculos

  /rhai_edge_occ_edu/insert:
    post:
      tags: [Ocupa√ß√£o ‚Üî Cursos]
      summary: Criar v√≠nculo
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                p_occupation_id: { type: integer }
                p_course_id: { type: integer }
                p_mandatory: { type: boolean }
                p_relevance: { type: string, enum: [AR,MR,BR] }
                p_notes: { type: string }
      responses:
        '200':
          description: V√≠nculo criado
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno

  /rhai_edge_occ_edu/update:
    put:
      tags: [Ocupa√ß√£o ‚Üî Cursos]
      summary: Atualizar v√≠nculo
      responses:
        '200':
          description: V√≠nculo atualizado
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno

  /rhai_edge_occ_edu/delete/{id}:
    delete:
      tags: [Ocupa√ß√£o ‚Üî Cursos]
      summary: Remover v√≠nculo (soft delete)
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: V√≠nculo removido
        '404':
          description: V√≠nculo n√£o encontrado

  # ============================================================
  # üîπ BLOCO: HARD SKILLS
  # ============================================================
  /rhai_edge_hard_skills_crud:
    post:
      tags: [Hard Skills]
      summary: CRUD de Hard Skills
      description: >
        Endpoint unificado para manipula√ß√£o da **biblioteca de Hard Skills**.  
        A a√ß√£o deve ser informada no corpo (`create`, `update`, `delete`, `list`).  
        Toda altera√ß√£o √© registrada em `skills_library_logs`.  
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [action]
              properties:
                action:
                  type: string
                  enum: [create, update, delete, list]
                  example: create
                p_skill_name:
                  type: string
                  example: "Excel"
                p_area:
                  type: string
                  example: "Administra√ß√£o"
                p_id:
                  type: integer
                  example: 1
                p_search:
                  type: string
                  example: "excel"
                p_only_active:
                  type: boolean
                  example: true
                p_only_validated:
                  type: boolean
                  example: false
      responses:
        '200':
          description: Resposta da opera√ß√£o CRUD
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean }
                  action:  { type: string }
                  results: { type: object }
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno do servidor

  /rhai_edge_search_hard_skills:
    post:
      tags: [Hard Skills]
      summary: Autocomplete de Hard Skills
      description: >
        Retorna lista de Hard Skills **ativas** com busca parcial (ILIKE)  
        em `skill_name` e `normalized_name`.  
        Usado em dropdowns/autocomplete no Lovable.  
        Suporta GET (?q=texto) e POST ({ q: "texto" }).  
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                q:
                  type: string
                  example: "excel"
      responses:
        '200':
          description: Lista de hard skills encontradas
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean }
                  results:
                    type: array
                    items:
                      type: object
                      properties:
                        id:          { type: integer, example: 2 }
                        skill_name:  { type: string, example: "Excel" }
                        area:        { type: string, example: "Administra√ß√£o" }
        '500':
          description: Erro interno

  # ============================================================
  # üîπ BLOCO: SOFT SKILLS
  # ============================================================
  /rhai_edge_soft_skills_crud:
    post:
      tags: [Soft Skills]
      summary: CRUD de Soft Skills
      description: >
        Endpoint unificado para manipula√ß√£o da **biblioteca de Soft Skills**.  
        A a√ß√£o deve ser informada no corpo (`create`, `update`, `delete`, `list`).  
        Toda altera√ß√£o √© registrada em `skills_library_logs`.  
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [action]
              properties:
                action:
                  type: string
                  enum: [create, update, delete, list]
                  example: create
                p_soft_skill_name:
                  type: string
                  example: "Resili√™ncia"
                p_theme:
                  type: string
                  example: "Interpessoal"
                p_id:
                  type: integer
                  example: 1
                p_search:
                  type: string
                  example: "resiliencia"
                p_only_active:
                  type: boolean
                  example: true
                p_only_validated:
                  type: boolean
                  example: false
      responses:
        '200':
          description: Resposta da opera√ß√£o CRUD
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean }
                  action:  { type: string }
                  results: { type: object }
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno do servidor

  /rhai_edge_search_soft_skills:
    post:
      tags: [Soft Skills]
      summary: Autocomplete de Soft Skills
      description: >
        Retorna lista de Soft Skills **ativas** com busca parcial (ILIKE)  
        em `soft_skill_name` e `normalized_name`.  
        Usado em dropdowns/autocomplete no Lovable.  
        Suporta GET (?q=texto) e POST ({ q: "texto" }).  
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                q:
                  type: string
                  example: "resiliencia"
      responses:
        '200':
          description: Lista de soft skills encontradas
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean }
                  results:
                    type: array
                    items:
                      type: object
                      properties:
                        id:               { type: integer, example: 1 }
                        soft_skill_name:  { type: string, example: "Resili√™ncia Emocional" }
                        theme:            { type: string, example: "Lideran√ßa" }
        '500':
          description: Erro interno


