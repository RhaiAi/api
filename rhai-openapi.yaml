openapi: 3.0.3
info:
  title: RHAI API
  description: >
    Cat√°logo oficial de endpoints da plataforma RHAI.  
    Apenas **Edge Functions** ficam expostas no Swagger.  
    RPCs e tabelas internas n√£o aparecem.  
  version: 1.0.0
  contact:
    name: Time RHAI
    email: suporte@rhai.com

servers:
  - url: https://gmtexatrdgqaymnknopd.supabase.co/functions/v1
    description: Supabase RHAI (produ√ß√£o)
  - url: http://localhost:54321/functions/v1
    description: Supabase RHAI (local dev)

tags:
  - name: Busca Ocupacional
    description: Endpoints relacionados √† super busca e autocomplete de ocupa√ß√µes.
  - name: Cursos
    description: Endpoints para CRUD de cursos.
  - name: Ocupa√ß√£o ‚Üî Cursos
    description: Endpoints para vincular cursos √†s ocupa√ß√µes.

paths:
  # ============================================================
  # üîπ BLOCO: BUSCA OCUPACIONAL
  # ============================================================
  /search-occupation:
    post:
      tags: [Busca Ocupacional]
      summary: Super Busca Ocupacional (RHAI)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [search_term]
              properties:
                search_term:
                  type: string
                  example: "engenheiro de prompt"
      responses:
        '200':
          description: Resposta padronizada
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno do servidor

  /rhai_edge_search_occupation_list:
    get:
      tags: [Busca Ocupacional]
      summary: Autocomplete ocupa√ß√µes
      parameters:
        - name: query
          in: query
          schema: { type: string }
        - name: limit
          in: query
          schema: { type: integer, default: 20 }
        - name: offset
          in: query
          schema: { type: integer, default: 0 }
      responses:
        '200':
          description: Lista de ocupa√ß√µes para autocomplete
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id: { type: integer }
                    name: { type: string }
  
    /rhai_edge_search_occupation_list/list:
    get:
      tags: [Busca Ocupacional]
      summary: Autocomplete / Listar ocupa√ß√µes ativas
      description: Retorna ocupa√ß√µes **ativas** com busca por nome (ILIKE). Usado em dropdowns/autocomplete.
      parameters:
        - name: query
          in: query
          description: Texto para busca (ILIKE %query%)
          schema: { type: string }
        - name: limit
          in: query
          schema: { type: integer, default: 50, minimum: 1, maximum: 200 }
        - name: offset
          in: query
          schema: { type: integer, default: 0, minimum: 0 }
      responses:
        '200':
          description: Lista de ocupa√ß√µes (id + name)
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok: { type: boolean, example: true }
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:   { type: integer, example: 747 }
                        name: { type: string,  example: "Administrador de Empresas" }
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno

  # ============================================================
  # üîπ BLOCO: CURSOS
  # ============================================================
  /rhai_edge_courses_new/list:
    get:
      tags: [Cursos]
      summary: Lista cursos
      parameters:
        - name: p_query
          in: query
          schema: { type: string }
        - name: p_limit
          in: query
          schema: { type: integer, default: 50 }
        - name: p_offset
          in: query
          schema: { type: integer, default: 0 }
      responses:
        '200':
          description: Lista de cursos

  /rhai_edge_courses_new/insert:
    post:
      tags: [Cursos]
      summary: Inserir curso
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                p_name: { type: string }
                p_qualification_type_id: { type: integer }
                p_country_id: { type: integer }
      responses:
        '200':
          description: Curso inserido com sucesso
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno do servidor

  /rhai_edge_courses_new/update:
    put:
      tags: [Cursos]
      summary: Atualizar curso
      responses:
        '200':
          description: Curso atualizado
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno do servidor

  /rhai_edge_courses_new/delete/{id}:
    delete:
      tags: [Cursos]
      summary: Remover curso
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Curso removido
        '404':
          description: Curso n√£o encontrado

  /rhai_edge_search_courses_autocomplete:
    get:
      summary: Autocomplete de cursos
      description: >
        Retorna lista de cursos ativos para alimentar dropdowns com busca.  
        Usa `LIKE %%` no nome e nome_normalized.  
        Sempre limitado/paginado.  
      parameters:
        - name: query
          in: query
          schema: { type: string }
          description: Termo de busca parcial
          example: "administra√ß√£o"
        - name: limit
          in: query
          schema: { type: integer, default: 20 }
          description: M√°ximo de registros a retornar
        - name: offset
          in: query
          schema: { type: integer, default: 0 }
          description: Offset para pagina√ß√£o
      responses:
        '200':
          description: Lista de cursos encontrados
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  results:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          example: 1
                        name:
                          type: string
                          example: "Administra√ß√£o"
                        qualification_type:
                          type: string
                          example: "Bacharelado"
                        country_name:
                          type: string
                          example: "Brasil"
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno


  # ============================================================
  # üîπ BLOCO: OCUPA√á√ÉO ‚Üî CURSOS
  # ============================================================
  /rhai_edge_occ_edu/list:
    get:
      tags: [Ocupa√ß√£o ‚Üî Cursos]
      summary: Lista v√≠nculos Ocupa√ß√£o ‚Üî Curso
      parameters:
        - name: p_occupation_ids
          in: query
          schema: { type: array, items: { type: integer } }
        - name: p_course_ids
          in: query
          schema: { type: array, items: { type: integer } }
      responses:
        '200':
          description: Lista de v√≠nculos Ocupa√ß√£o ‚Üî Curso

  /rhai_edge_occ_edu/insert:
    post:
      tags: [Ocupa√ß√£o ‚Üî Cursos]
      summary: Inserir v√≠nculo
      requestBody:
        required: true
        content:
          application/json:
            schema:
              properties:
                p_occupation_id: { type: integer }
                p_course_id: { type: integer }
                p_mandatory: { type: boolean }
                p_relevance: { type: string, enum: [AR,MR,BR] }
      responses:
        '200':
          description: V√≠nculo criado
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno

  /rhai_edge_occ_edu/update:
    put:
      tags: [Ocupa√ß√£o ‚Üî Cursos]
      summary: Atualizar v√≠nculo
      responses:
        '200':
          description: V√≠nculo atualizado
        '400':
          description: Erro de valida√ß√£o
        '500':
          description: Erro interno

  /rhai_edge_occ_edu/delete/{id}:
    delete:
      tags: [Ocupa√ß√£o ‚Üî Cursos]
      summary: Remover v√≠nculo
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: V√≠nculo removido
        '404':
          description: V√≠nculo n√£o encontrado
